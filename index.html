<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8"/>
	<title>Orbital Planet Defender</title>
	<link rel="stylesheet" href="../Canvasloth/canvasloth.css"/>
	<script src="../Canvasloth/canvasloth.js"></script>
	<script src="../Canvasloth/canvasloth-sprite.js"></script>
	<!--<script src="../jquery.js"></script>-->
	<style>
	body {
		background: #111;
		}
	.canvasloth {
		width: 800px;
		height: 600px;
		margin: 30px auto;
		}
		canvas {
			background: rgb(0,0,0);
			}
		.canvasloth-hud-below {
			font: 11px/14px sans-serif;
			}
			.canvasloth-hud-below .console {
				position: absolute;
				overflow: hidden;
				width: 200px;
				left: 0;
				top: 0;
				bottom: 0;
				border-right: 1px dashed rgba(255,255,255,.5);
				padding: .2em .3em;
				color: rgba(200,200,200,.8);
				background: rgba(0,0,0,.92);
				}
				.canvasloth-hud-below .console b {
					color: rgba(200,200,200);
					}
		.canvasloth-hud-above {
			}
	</style>
	<script>
	function lg(s) { console.log(s); }

	function main() {
		new Canvasloth({
			container: document.querySelector('.canvasloth'),
			context: '2d',
			// autoFocus: true,
			fps: 5,
			fps: 60,
			thisApp: {
				earth: {
					radius: 100,
					atmosphereSize: 10,
					angle: 0,
					init: function(cnv, ctx) {
						this.spEarth = new canvaslothSprite(ctx, cnv.image('earth.png'))
							.pivotX("center").pivotY("center")
							.dstSize(this.radius * 2);
						this.spShadow = new canvaslothSprite(ctx, cnv.image('earthShadow.png'))
							.pivotX("center").pivotY("center")
							.dstSize((this.radius + this.atmosphereSize) * 2)
							.opacity(.3);
					},
					draw: function(ctx, ft) {
						// earth
						ctx.save();
							ctx.rotate(this.angle += 1 * ft);
								this.spEarth.draw(0, 0);
						ctx.restore();
						// atmosphere
						ctx.lineWidth = this.atmosphereSize;
						ctx.strokeStyle = "#fff";
						ctx.globalAlpha = .2;
						ctx.beginPath();
							ctx.arc(0, 0, this.radius + this.atmosphereSize / 2, 0, Math.PI * 2, true);
						ctx.stroke();
						// shadow
						this.spShadow.draw(0, 0);
					}
				},
				render: function() {
					var	ctx = this.ctx,
						fTime = this.cnv.frameTime();
					ctx.save();
						ctx.translate(this.w / 2, this.h / 2);
							this.sprite_space.draw(0, 0);
							this.earth.draw(ctx, fTime);
					ctx.restore();
				}
			},
			ready: function(cnv, ctx) {
				this.cnv = cnv;
				this.ctx = ctx;
				this.w = ctx.canvas.width;
				this.h = ctx.canvas.height;
				this.earth.init(cnv, ctx);
				this.sprite_space = new canvaslothSprite(ctx, cnv.image('space.jpg'))
					.pivotX("center").pivotY("center")
					.dstSizeNorm(.8, .8)
					.opacity(.7);
			},
			loop: function() {
				this.ctx.clearRect(0, 0, this.w, this.h);
				this.render();
			},
			events: {
				mouseDown: function(x, y, btn) {
				},
				mouseUp: function(x, y, btn) {
				},
				mouseMove: function(x, y) {
					x -= this.w / 2;
					y -= this.h / 2;
				}
			}
		});
	}

	// $(main);
	window.onload = main;
	</script>
</head>
<body>
	<div class="canvasloth">
		<div class="canvasloth-assets">
			<img src="img/space.jpg"/>
			<img src="img/earth.png"/>
			<img src="img/earthShadow.png"/>
		</div>
		<div class="canvasloth-hud-below">
		</div>
		<div class="canvasloth-hud-above">
		</div>
	</div>
</body>
</html>
